{% extends 'base.html.twig' %}
{% block title %}Ajouter Facture | BusinessPark{% endblock %}


{% block content %}
    <!-- start: CSS REQUIRED FOR THIS PAGE ONLY -->
        <link href="{{asset('vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.css')}}" rel="stylesheet" media="screen">
        <link href="{{asset('vendor/select2/select2.min.css')}}" rel="stylesheet" media="screen">
        <link href="{{asset('vendor/bootstrap-datepicker/bootstrap-datepicker3.standalone.min.css')}}" rel="stylesheet" media="screen">
        <link href="{{asset('vendor/bootstrap-timepicker/bootstrap-timepicker.min.css')}}" rel="stylesheet" media="screen">
    <!-- end: CSS REQUIRED FOR THIS PAGE ONLY -->
    
    <section id="page-title">
        <div id="nc" style="display:none;"> {{id}} </div>
            <div class="row">
                <div class="col-sm-8">
                    <h1 class="mainTitle">Gestion de facturetion </h1>
                    
                </div>
                <ol class="breadcrumb">
                    <li>
                        <span>gestion des facture</span>
                    </li>
                    <li class="active">
                        <span>ajouter</span>
                    </li>
                </ol>
        </div>
    </section>

    <div class="container-fluid container-fullw bg-white">
                        <div class="col-md-12">
                            <div class="invoice">
                                <div class="row invoice-logo">
                                            <div class="col-sm-6">
                                                <img alt="" src="{{asset('assets/images/your-logo-here.png')}}">
                                            </div>
                                            <div class="col-sm-6">
                                                <p class="text-dark">
                                                    #{{id}} / {{"now"|date('d M Y')}} <small class="text-light"> Lorem ipsum dolor sit amet </small>
                                                </p>
                                            </div>
                                    </div>
                                        <hr>
                        <div class="row">
                             <div class="col-sm-12">
                                 <h5 class="over-title">Liste produits de cette <span class="text-bold">Bon de reception</span></h5>
                <!-- This Table is generated by an json request from the file "FactureController" 
                Look bottom in jqueqy code !!


                -->
                                 <table class="table table-striped" id="pro">
                                                

                                     <thead>
                                       <tr>
                                           <th> # </th>
                                           <th> Produit </th>
                                           <th class="hidden-480"> Description </th>
                                           <th class="hidden-480"> Quantité </th>
                                           <th class="hidden-480"> Prix unitaire </th>
                                           <th class="price"> Total </th>
                                           <th>  </th>
                                       </tr>
                                     </thead>
                                     <tbody id="desplay_area">

                                                        
                                     </tbody>
                                                </table>
                                            </div>
                                        </div>
                             <div class="col-md-12">

                 <!-- This is a form for adding a product to an invoice and sended by an Ajax request to the file "FactureController" 
                Look bottom in jqueqy code !!
                 -->
                                 <h5 class="over-title">Ajouter produit au <span class="text-bold">Facture</span></h5>
                                     <div class="col-md-9" >
                                         <fieldset>
                                             <legend>
                                             Information
                                             </legend>
                                             {{ form_start(form2) }}
                                             {{ form_errors(form2) }} 
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="">
                                                            <label>
                                                                Produit
                                                            </label>
                                                            {{ form_widget(form2.produit) }}
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label>
                                                                Quantite
                                                            </label>
                                                            {{ form_widget(form2.quantite,{ 'attr': {'class': 'form-control'} }) }}
                                                        </div>
                                                    </div>
                                                     
                                                </div>
                                                
                                                 {{ form_widget(form2.save,{ 'attr': {'class': 'ff btn btn-o btn-primary'} }) }}
                                                  <img style="display:none" src="{{asset('assets/ajax.gif')}}" class="bb">
                                    
                                                        {{ form_rest(form2) }}
                                                        {{ form_end(form2) }} 
                                            </fieldset>
                                    </div>
                               </div>
                                        
                                        <hr>
                                    </div>
                        </div>


                       
                      <div class="col-md-12">
              <!-- This is a form for saving the invoice
                   there are fields which generated automaticly with Jquery 
                Look bottom in jqueqy code !!
                 -->
               
                          <h5 class="over-title">Créer  <span class="text-bold">Une facture</span></h5>
                          <div class="col-md-9" >
                                <fieldset>
                                   <legend>
                                                Information
                                                </legend>
                                                {{ form_start(form) }}
                                            {{ form_errors(form) }}

                                                <div class="row">
                                                    <div class="col-md-6">

                                          
                                                        <div class="form-group">
                                                            <label>
                                                                Montons totale
                                                            </label>
                                                            {{ form_widget(form.total,{ 'attr': {'class': 'form-control'} }) }}
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label>
                                                                Date facture
                                                            </label>
                                                            {{ form_widget(form.datefacture,{ 'attr': {'class': 'form-control'} }) }}
                                                        </div>
                                                    </div>
                                                     
                                                </div>
                                                
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label">
                                                                Client  
                                                            </label>
                                                            {{ form_widget(form.client,{ 'attr': {'class': 'form-control'} }) }}
                                                            
                                                        </div>
                                                    </div>
                                                     <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label">
                                                                Taxe  
                                                            </label>
                                                            {{ form_widget(form.taxe,{ 'attr': {'class': 'form-control'} }) }}
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label">
                                                                Type de payment  
                                                            </label>
                                {{ form_widget(form.typepaiment,{ 'attr': {'class': 'form-control'} }) }}
                                                            
                                                        </div>
                                                    </div>
                                                   
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label">
                                                                Status 
                                                            </label>
                                                            {{ form_widget(form.status,{ 'attr': {'class': 'form-control'} }) }}
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label">
                                                                Description  
                                                            </label>
                                                            {{ form_widget(form.description,{ 'attr': {'class': 'form-control'} }) }}
                                                            
                                                        </div>
                                                    </div>
                                                   
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label">
                                                                Etat de Stock  
                                                            </label>
                                                            {{ form_widget(form.remise,{ 'attr': {'class': 'clip-radio radio-primary'} }) }}
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                   
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label">
                                                                Etat de Stock  
                                                            </label>
                                                            {{ form_widget(form.etat,{ 'attr': {'class': 'clip-radio radio-primary'} }) }}
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                                    
 
                                                    
                                 
                                                
                                                  
                                    
                                    {{ form_widget(form.save,{ 'attr': {'class': 'btn btn-o btn-primary'} }) }}
                                    {{ form_rest(form) }}
                                                        {{ form_end(form) }} 
                                                
                                                    
                                </fieldset>
                                </div>
                      </div>  
    </div>

{% endblock %}
{% block jspage  %}
        <!-- start: JAVASCRIPTS REQUIRED FOR THIS PAGE ONLY -->
        <script src="{{asset('vendor/maskedinput/jquery.maskedinput.min.js')}}"></script>
        <script src="{{asset('vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js')}}"></script>
        <script src="{{asset('vendor/autosize/autosize.min.js')}}"></script>
        <script src="{{asset('vendor/selectFx/classie.js')}}"></script>
        <script src="{{asset('vendor/selectFx/selectFx.js')}}"></script>
        <script src="{{asset('vendor/select2/select2.min.js')}}"></script>
        <script src="{{asset('vendor/bootstrap-datepicker/bootstrap-datepicker.min.js')}}"></script>
        <script src="{{asset('vendor/bootstrap-timepicker/bootstrap-timepicker.min.js')}}"></script>
        <!-- end: JAVASCRIPTS REQUIRED FOR THIS PAGE ONLY -->

        <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
        <script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>
        <!-- start: JavaScript Event Handlers for this page -->
        <script src="{{asset('assets/js/form-elements.js')}}"></script>

        <script>
            jQuery(document).ready(function() {
                desplay_data();
                Main.init();
                FormElements.init();
                 /* this form  is for adding a product from the invoice */         

                var frm = $('form:eq(1)');
                frm.submit(function(e){
                    
                    $.ajax({
                        type: 'POST',
                        url: "{{path('ajouter_facture',{'id': id})}}",
                        data: frm.serialize(),
                        beforeSend: function(){
                            console.log('charge');
                            $('.bb').css( "display", "initial" );
                        },
                        success: function(data){
                            $('.bb').css( "display", "none" );
                            
                            $('form').trigger("reset");
                            desplay_data();
                            },
                        error: function (xhr, ajaxOptions, thrownError) {
                                 console.log(xhr.status);
                                 console.log(xhr.responseText);
                                 alert(xhr.responseText);
                                 alert(xhr.status);
                                 alert(xhr.thrownError);
                                 console.log(thrownError);
                                 $('.bb').css( "display", "none" );
                            },

                    });
                    e.preventDefault();
                     
                    //$('#pro').load("  #pro");
                });

 /* this class ".rmv" is a botton which will delete a product from the invoice */         

$('.rmv').click(function(e){
   var id = $(this).attr('id');
   
     $.ajax({
                        type: 'POST',
                        dataType: 'json',
                        
                        url: "",
                        
                        beforeSend: function(){
                            console.log('charge');
                            
                        },
                        success: function(data){
                             console.log('cb1');
                             desplay_data();
                            

                        },
                        error: function (xhr, ajaxOptions, thrownError) {
           console.log(xhr.status);
           console.log(xhr.responseText);
           alert(xhr.responseText);
           alert(xhr.status);
           alert(xhr.thrownError);
           console.log(thrownError);
       },

                    });
                    e.preventDefault();
                     
                    
});
          
});
 
 /* this function will communicate with the controller for display the products of invoice*/         
function desplay_data(){
               
    $.ajax({
        url: "{{path('ceslignesf',{'id': id})}}",
        type: 'POST',
        data: {
            "display": 1
        },
        beforeSend: function(){
                            console.log('charge');
                            
                        },
        success: function(d){
                             console.log('cb1');
                             $('#desplay_area').html(d);
                             

                        },
        error: function (xhr, ajaxOptions, thrownError) {
           console.log(xhr.status);
           console.log(xhr.responseText);
           alert(xhr.responseText);
           alert(xhr.status);
           alert(xhr.thrownError);
           console.log(thrownError);
       },


    });

};

            
        </script>
        
        {% endblock %}